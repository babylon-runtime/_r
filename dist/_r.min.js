!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self)._r=n()}(this,function(){"use strict";var is,_scene,_engine,_canvas;console.log("babylon runtime v0.1.0-beta-3"),function(a){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e){return r(e)&&"#"==e[0]}function r(e){return"string"==typeof e}function e(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function o(e,n){if("string"!=typeof e)return!1;var t=e.split(".");if(1===t.length)return!1;var r=t.pop().trim();if(a.Array(n)){n=n;for(var o=0;o<n.length;o++){var i=n[o].trim();if(i===r||i==="."+r)return!0}return!1}return n===r||n==="."+r}a.Function=function(e){return e&&"[object Function]"==={}.toString.call(e)},a.Number=n,a.PlainObject=function(e){if("object"!=typeof e||null===e)return!1;if("function"!=typeof Object.getPrototypeOf)return"[object Object]"==Object.prototype.toString.call(e);var n=Object.getPrototypeOf(e);return n===Object.prototype||null===n},a.AssetContainer=function(e){return e instanceof BABYLON.AssetContainer},a.Scene=function(e){return e instanceof BABYLON.Scene},a.TransformNode=function(e){return e instanceof BABYLON.TransformNode},a.Array=function(e){return window.Array.isArray(e)},a.Mesh=function(e){return e instanceof BABYLON.AbstractMesh},a.Material=function(e){return e instanceof BABYLON.Material},a.MultiMaterial=function(e){return e instanceof BABYLON.MultiMaterial},a.Texture=function(e){return e instanceof BABYLON.Texture},a.Light=function(e){return e instanceof BABYLON.Light},a.Camera=function(e){return e instanceof BABYLON.Camera},a.Vector3=function(e){return e instanceof BABYLON.Vector3||a.Array(e)&&3==e.length},a.Vector2=function(e){return e instanceof BABYLON.Vector2},a.Color=function(e){return t(e)||e instanceof BABYLON.Color3||e instanceof BABYLON.Color4||a.String(e)&&(0==e.trim().indexOf("rgb(")||0==e.trim().indexOf("rgba("))},a.HexColor=t,a.Float=function(e){return n(e)===e&&e%1!=0},a.Int=function(e){return n(e)===e&&e%1==0},a.Quaternion=function(e){return e instanceof BABYLON.Quaternion},a.Matrix=function(e){return e instanceof BABYLON.Matrix},a.String=r,a.Size=function(e){return e instanceof BABYLON.Size},a.PatchFile=function(e){return o(e,["runtime","patch","js"])},a.Boolean=function(e){return"boolean"==typeof e},a.BabylonNode=function(e){return a.Camera(e)||a.Light(e)||a.Material(e)||a.Mesh(e)||a.Texture(e)},(a.DOM=e).canvas=function(e){return e instanceof HTMLCanvasElement},e.div=function(e){return e instanceof HTMLDivElement},e.image=function(e){return e instanceof HTMLImageElement},a.Primitive=function(e){return e!==Object(e)},a.Promise=function(e){return e&&"function"==typeof e.then},a.FileWithExtension=o,a.ImageFile=function(e){return o(e,["jpg","jpeg","png","gif"])}}(is||(is={}));var global=function(){function e(){}return Object.defineProperty(e,"canvas",{get:function(){if(_canvas)return _canvas;if(BABYLON.Engine.LastCreatedEngine){var e=BABYLON.Engine.LastCreatedEngine.getRenderingCanvas();if(e)return _canvas=e}return(_canvas=document.createElement("canvas")).setAttribute("touch-action","none"),_canvas.style.width="100%",_canvas.style.height="100%",_canvas},set:function(e){_canvas=is.String(e)?document.getElementById(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"engine",{get:function(){return _engine||(_engine=BABYLON.Engine.LastCreatedEngine?BABYLON.Engine.LastCreatedEngine:new BABYLON.Engine(e.canvas,!0)),_engine},set:function(e){_engine=e,window.addEventListener("resize",function(){_engine.resize()})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scene",{get:function(){return _scene||(_scene=BABYLON.Engine.LastCreatedScene?BABYLON.Engine.LastCreatedScene:new BABYLON.Scene(e.engine)),_scene},set:function(e){_scene=e},enumerable:!0,configurable:!0}),e.fn={},e.TRACE=!1,e}(),cache=[],expando="_r"+Date.now();function data(e,n,t){return e.hasOwnProperty(expando)||(e[expando]=cache.length,cache[e[expando]]={}),null==n?cache[e[expando]]:void 0===t?cache[e[expando]][n]:void(cache[e[expando]][n]=t)}function on(e,n,t,r){void 0===r&&(r=!0),data(e,"_r.e")||data(e,"_r.e",{});var o=data(e,"_r.e");o[n]||(o[n]=[]),o[n].push({handler:t,repeat:r})}function one(e,n,t){on(e,n,t,!1)}function trigger(t,r){for(var o=[],e=2;e<arguments.length;e++)o[e-2]=arguments[e];var n=data(t,"_r.e");if(n){var i=n[r];is.Array(i)&&i.forEach(function(e){var n;try{(n=e.handler).call.apply(n,[t].concat(o)),e.repeat||off(t,r,e.handler)}catch(e){console.error("_r.trigger exception",e)}})}}function off(e,n,t){var r=data(e,"_r.e");r[n]&&(r[n]=t?r[n].filter(function(e){e.handler.toString()==t.toString()&&r[n].splice(r[n].indexOf(e),1)}):[])}global.fn.data=function(e,n){if(null==e||null==n)return data(this[0],e,n);for(var t=0;t<this.length;t++)data(this[t],e,n)};var e=Object.freeze({on:on,one:one,trigger:trigger,off:off});function getQueryStringParameter(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function updateUrlParameter(e,n,t){var r=e.indexOf("#"),o=-1===r?"":e.substr(r);e=-1===r?e:e.substr(0,r);var i=new RegExp("([?&])"+n+"=.*?(&|$)","i"),a=-1!==e.indexOf("?")?"&":"?";return t?e=e.match(i)?e.replace(i,"$1"+n+"="+t+"$2"):e+a+n+"="+t:("?"===(e=e.replace(new RegExp("([?&]?)"+n+"=[^&]*","i"),"")).slice(-1)&&(e=e.slice(0,-1)),-1===e.indexOf("?")&&(e=e.replace(/&/,"?"))),e+o}var queryString={get:function(e){return getQueryStringParameter(e)},set:function(e,n){if(history.pushState){var t=updateUrlParameter(window.location.href,e,n);window.history.pushState({path:t},"",t)}this.trigger(e,n)},on:function(e,n,t){void 0===t&&(t=!0),on(this,e,n,t)},off:function(e,n){off(this,e,n)},one:function(e,n){one(this,e,n)},trigger:function(e,n){trigger(this,e,n)}};function extend(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t,r,o,i,a,s,c=e[0],l=1,u=e.length,f=!1;for("boolean"==typeof c&&(f=c,c=arguments[1]||{},l++),"object"==typeof c||is.Function(c)||(c={});l<u;l++)if(null!=(t=arguments[l]))for(r in t)o=c[r],c!=(i=t[r])&&(f&&i&&(is.PlainObject(i)||(a=is.Array(i)))?(s=a?(a=!1,o&&is.Array(o)?o:[]):o&&is.PlainObject(o)?o:{},c[r]=extend(f,s,i)):void 0!==i&&(c[r]=i));return c}function activateCamera(e){global.scene.activeCamera&&global.scene.activeCamera.detachControl(),is.String(e)?global.scene.setActiveCameraByName(e):global.scene.activeCamera=e,global.scene.activeCamera.attachControl(global.canvas)}var plugins=[];function registerPlugin(e){plugins.push(e)}function getPlugin(e,n,t){for(var r=null,o=0;o<plugins.length;o++)plugins[o].test(e,n,t)&&(r=plugins[o]);return r}var Selector=function(){function e(e){this.type="all";var t=[],n="all",r=e.trim();-1!==r.indexOf(":mesh")&&(n="mesh"),-1!==r.indexOf(":material")&&(n="material"),-1!==r.indexOf(":light")&&(n="light"),-1!==r.indexOf(":camera")&&(n="camera"),-1!==r.indexOf(":texture")&&(n="texture"),-1!==r.indexOf(":multimaterial")&&(n="multimaterial"),-1!==r.indexOf(":transformNode")&&(n="transformNode"),[":mesh",":material",":multimaterial",":camera",":light",":texture",":transformNode"].forEach(function(e){r=r.replace(e,"")});for(var o,i=/\[(.*?)\]/,a=[];o=i.exec(e);)a.push(o[1]),e=e.replace(i,"");a.forEach(function(o){if(-1!==o.indexOf("!=")){var i=(n=o.split("!="))[0].trim(),a=n[1].trim();try{a=JSON.parse(a)}catch(e){try{a=JSON.parse(JSON.stringify(a))}catch(e){console.error("_r.select - incorrect parameter : "+a)}}var e=function(e){for(var n=i.split("."),t=e,r=0;r<n.length;r++)t=null!=t&&null!=t[n[r]]?t[n[r]]:null;return null!=t&&t!=a};t.push(e)}else if(-1!==o.indexOf("=")){var n,s=(n=o.split("="))[0].trim(),c=n[1].trim();try{c=JSON.parse(c)}catch(e){try{c=JSON.parse(JSON.stringify(c))}catch(e){console.error("_r.select - incorrect parameter : "+c)}}e=function(e){for(var n=s.split("."),t=e,r=0;r<n.length;r++)t=null!=t&&null!=t[n[r]]?t[n[r]]:null;return null!=t&&t==c};t.push(e)}else{e=function(e){for(var n=o.trim().split("."),t=e,r=0;r<n.length;r++)t=null!=t&&null!=t[n[r]]?t[n[r]]:null;return null!=t};t.push(e)}});var s=(r=(r=r.replace(i,"")).replace(/\./g,"\\.")).replace(/\*/g,".*"),c=new RegExp("^"+s+"$");t.push(function(e){return e.hasOwnProperty("name")&&c.test(e.name)}),this.filters=t,this.type=n}return e.prototype.matchFilters=function(e){for(var n=0;n<this.filters.length;n++)if(!this.filters[n](e))return!1;return!0},e.prototype.matchType=function(e){return"all"==this.type||("mesh"==this.type?is.Mesh(e):"light"==this.type?is.Light(e):"material"==this.type?is.Material(e):"multimaterial"==this.type?is.MultiMaterial(e):"texture"==this.type?is.Texture(e):"camera"==this.type?is.Camera(e):"transformNode"==this.type?is.TransformNode(e):void 0)},e}(),Elements=function(){function o(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var t=this.length=0;t<e.length;t++)this.add(e[t])}return o.prototype.add=function(e){if(is.Array(e))for(var n=0;n<e.length;n++)this.add(e[n]);else if(is.AssetContainer(e)){for(n=0;n<e.meshes.length;n++)this[this.length++]=e.meshes[n];for(n=0;n<e.lights.length;n++)this[this.length++]=e.lights[n];for(n=0;n<e.materials.length;n++)this[this.length++]=e.materials[n];for(n=0;n<e.textures.length;n++)this[this.length++]=e.textures[n];for(n=0;n<e.cameras.length;n++)this[this.length++]=e.cameras[n]}else this[this.length++]=e},o.prototype.contains=function(e){return-1!==this.toArray().indexOf(e)},o.prototype.each=function(e){for(var n=0;n<this.length;n++)if(0==e.call(this[n],this[n],n))return;return this},o.prototype.forEach=function(e){return this.each(e)},o.prototype.map=function(n){var t=new o,r=0;return this.each(function(e){t[r++]=n(e)}),t.length=r,t},o.prototype.filter=function(n){var t=new o;return this.each(function(e){n(e)&&t.add(e)}),t},o.prototype.toArray=function(){for(var e=[],n=0;n<this.length;n++)e.push(this[n]);return e},o.prototype.attr=function(n,t){return null!=t?(this.each(function(e){e[n]=t}),this):this[0][n]},o.prototype.first=function(){return this[0]},o.prototype.log=function(n){this.each(function(e){n?console.log(e[n]):console.log(e)})},o.prototype.concat=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.forEach(function(e){var n;e instanceof o?n=e:is.String(e)?n=new o(e):is.Array(e)?(n=new o,e.forEach(function(e){n[n.length++]=e})):n=new o(e),n.each(function(e){this[this.length++]=e})}),this},o.prototype.select=function(e){return 1===this.length&&is.Scene(this[0])?find(e,this[0]):find(e,this)},o.prototype.dispose=function(){for(var e=0;e<this.length;e++)this[e].dispose(),delete this[e]},o.prototype.addToScene=function(){return this.each(function(e){is.Camera(e)&&global.scene.addCamera(e),is.Mesh(e)&&global.scene.addMesh(e),is.Material(e)&&global.scene.addMaterial(e),is.MultiMaterial(e)&&global.scene.addMultiMaterial(e),is.Texture(e)&&global.scene.addTexture(e),is.Light(e)&&global.scene.addLight(e)}),this},o.prototype.removeFromScene=function(){return this.each(function(e){return is.Camera(e)?(global.scene.removeCamera(e),!1):is.Mesh(e)?(global.scene.removeMesh(e),!1):is.Material(e)?(global.scene.removeMaterial(e),!1):is.MultiMaterial(e)?(global.scene.removeMultiMaterial(e),!1):is.Texture(e)?(global.scene.removeTexture(e),!1):is.Light(e)?(global.scene.removeLight(e),!1):void 0}),this},o.prototype.remove=function(e){},o}();function match(e,n){var t=new Selector(n);return t.matchType(e)&&t.matchFilters(e)}function find(e,t){var r=new Elements;return e.split(",").forEach(function(e){e=e.trim();var n=new Selector(e);if(is.Scene(t)||is.AssetContainer(t))switch(t=t,n.type){case"material":t.materials.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"mesh":t.meshes.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"light":t.lights.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"multimaterial":t.materials.forEach(function(e){is.MultiMaterial(e)&&n.matchFilters(e)&&r.add(e)});break;case"texture":t.textures.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"camera":t.cameras.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"transformNode":t.transformNodes.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"all":t.materials.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.meshes.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.lights.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.textures.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.cameras.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.transformNodes.forEach(function(e){n.matchFilters(e)&&r.add(e)})}else(t=t).forEach(function(e){n.matchType(e)&&n.matchFilters(e)&&r.add(e)})}),r}var libraries=[];function createLibrary(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];if(libraries[e])console.error("[_r] Error in _r.createLibrary : "+e+" already exists");else{var r=new Elements(n);libraries[e]=r,global.TRACE&&(console.groupCollapsed("[_r] - create library "+e),r.log(),console.groupEnd())}}function library(e){return libraries[e]}function select(n){var o;if(is.String(n)){if("scene"===n.toLowerCase())return new Elements(global.scene);o=find(n,global.scene),Object.getOwnPropertyNames(libraries).forEach(function(e){"length"!==e&&libraries[e].select(n).each(function(e){o.contains(e)||o.add(e)})}),!0===global.TRACE&&0==o.length&&console.warn('BABYLON.Runtime::no object(s) found for selector "'+n+'"')}else o=new Elements(n);var e=function(r){Elements.prototype[r]=function(){for(var e,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return(e=global.fn[r]).call.apply(e,[o].concat(n))}};for(var t in global.fn)e(t);return o}var counter=0;function load(e,n){if(is.Array(e)){var t=[];return(e=e).forEach(function(e){t.push(load(e))}),Promise.all(t)}return e=e,is.ImageFile(e)?load.image(e,n):is.FileWithExtension(e,["babylon","gltf","glb"])?load.assets(e,n):is.FileWithExtension(e,["json"])?load.JSON(e):is.FileWithExtension(e,["js"])?load.script(e):is.FileWithExtension(e,["css"])?load.css(e):is.FileWithExtension(e,["patch"])?load.patch(e):is.FileWithExtension(e,["txt"])?load.ajax(e):void 0}load.image=function(o,i){return new Promise(function(n,r){var e=new BABYLON.AssetsManager(global.scene),t=e.addImageTask("_r.preload.task"+counter++,o);t.onSuccess=function(e){if(i)return select(e.image).patch(i).then(function(){n(e.image)});n(e.image)},t.onError=function(e,n,t){console.error(n,t),r(n)},e.load()})},load.assets=function(e,n,t){var r=e.split("/").pop(),o=e.replace(r,"");return BABYLON.SceneLoader.ShowLoadingScreen=!1,BABYLON.SceneLoader.LoadAssetContainerAsync(o,r,global.scene,t).then(function(e){return n?select(e).globalPatch(n).then(function(){return BABYLON.SceneLoader.ShowLoadingScreen=!0,e}):(BABYLON.SceneLoader.ShowLoadingScreen=!0,e)})},load.material=function(e,n){var t=new BABYLON.StandardMaterial(e,global.scene);return select(t).patch(n).then(function(){return t})},load.pbr=function(e,n){var t=new BABYLON.PBRMaterial(e,global.scene);return select(t).patch(n).then(function(){return t})},load.texture=function(t,r){return load(t).then(function(e){var n=new BABYLON.Texture(t,global.scene);return r?select(n).patch(r).then(function(){return n}):n},function(e){console.error(e)})};var cubeCounter=0;load.cubeTexture=function(o,i){return new Promise(function(e,n){var t=new BABYLON.AssetsManager(global.scene),r=t.addCubeTextureTask("_r.load.cubeTexture."+cubeCounter++,o);r.onSuccess=function(e){return i?select(e.texture).patch(i):e.texture},r.onError=function(e){n(e)},t.load()})},load.patch=function(file){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("get",file,!0),xhr.onload=function(){var status=xhr.status;if(200==status){var data=void 0,isJson=!1;try{data=JSON.parse(xhr.response),isJson=!0}catch(e){isJson=!1}if(!isJson)try{data=window.eval.call(window,xhr.response)}catch(error){var __patch=void 0;eval("var __patch = "+xhr.response),data=__patch}data?resolve(data):(console.warn("BABYLON.Runtime::no data found in "+file),resolve([{}]))}else reject(status)},xhr.send()})};var ajaxCounter=0;function recursive(r,o,e){void 0===e&&(e=!0);var i=0;var n=function n(){if(i!==r.length){var e=r[i++];try{var t=o(e);return is.Promise(t)?t.then(function(){return n()}):n()}catch(e){return n()}}}();return is.Promise(n)?n:e?new Promise(function(e){e()}):n}function globalPatchItem(t,r){return is.PatchFile(t)?load.patch(t).then(function(e){return globalPatch(e)}):recursive(Object.getOwnPropertyNames(t),function(e){var n;if(r){if(n=getPlugin(r,t,e))return n.resolve(r,t,e)}else if(n=getPlugin(global.scene,t,e))return n.resolve(global.scene,t,e);return patchElements(find(e,r||global.scene).toArray(),t[e])},!1)}function globalPatch(e,n){return is.Array(e)||(e=[e]),recursive(e,function(e){return globalPatchItem(e,n)},!1)}function patchElements(e,n,t){return recursive(e,function(e){return patchElement(e,n,t)},!1)}function patchElement(n,t,r){return recursive(Object.getOwnPropertyNames(t),function(e){return r?r.push(n):r=[n],patchProperty(n,t,e,r)},!1)}function patchProperty(n,e,t,r){var o=getPlugin(n,e,t);if(o)return o.resolve(n,e,t,r);if(is.Primitive(e[t]))return n[t]=e[t],n[t];if(is.Function(e[t])){if(is.Function(n[t]))return n[t]=e[t],n[t];var i=e[t].apply(n,r);return is.Promise(i)?i.then(function(e){e&&(n[t]=e)}):(n[t]=i,n[t])}return is.Promise(e[t])?e[t].then(function(e){n[t]=e}):is.PlainObject(e[t])?(n[t]||(n[t]={}),patchElement(n[t],e[t],r)):void 0}function patch(e,t){if(void 0===t&&(t=!0),is.PatchFile(e))return load.patch(e).then(function(e){var n=globalPatch(e);return t&&!is.Promise(n)?new Promise(function(e){e(n)}):n});is.Array(e)||(e=[e]);var n=globalPatch(e);return t&&!is.Promise(n)?new Promise(function(e){e(n)}):n}load.ajax=function(o){return new Promise(function(n,t){var e=new BABYLON.AssetsManager(global.scene),r=e.addTextFileTask("_r.load.ajax."+ajaxCounter++,o);r.onSuccess=function(e){n(e.text)},r.onError=function(e){t(e)},e.load()})},load.JSON=function(e){return new Promise(function(t,r){load.ajax(e).then(function(e){try{var n=JSON.parse(e);t(n)}catch(e){r(e)}})})},load.script=function(o){return new Promise(function(e,n){var t=document.createElement("script");t.src=o;var r=!1;t.onreadystatechange=function(){if("complete"===this.readyState){if(r)return;e(),r=!0}},t.onload=function(){r||(e(),r=!0)},document.body.appendChild(t)})},load.css=function(o){return new Promise(function(e,n){var t=document.createElement("link");t.type="text/css",t.href=o;var r=!(t.rel="stylesheet");t.onreadystatechange=function(){if("complete"===this.readyState){if(r)return;e(),r=!0}},t.onload=function(){r||(e(),r=!0)},document.head.appendChild(t)})},patch.registerPlugin=registerPlugin,global.fn.patch=function(e,n){void 0===n&&(n=!0);var t=patchElements(this.toArray(),e);return n&&!is.Promise(t)?new Promise(function(e){e(t)}):t},global.fn.globalPatch=function(e,n){void 0===n&&(n=!0);var t=globalPatch(e,this.toArray());return n&&!is.Promise(t)?new Promise(function(e){e(t)}):t};var iFrameLoadingScreen=function(){function e(e,n){var t=this;this._attached=!1,this.iframe=document.createElement("iframe"),this.iframe.src=e,n&&(this.iframe.id=n),this.iframe.addEventListener("transitionend",function(){t.isVisible||(t.parentNode.removeChild(t.iframe),t._attached=!1)}),this.iframe.classList.add("runtime-loadingScreen")}return Object.defineProperty(e.prototype,"parentNode",{get:function(){return global.canvas.parentNode},enumerable:!0,configurable:!0}),e.prototype.displayLoadingUI=function(){var e=this;this._attached||(this.iframe.onload=function(){e.iframe.contentDocument?e._contentDocument=e.iframe.contentDocument:e._contentDocument=e.iframe.contentWindow.document,e.message=e._message,e._progress&&(e.progress=e._progress)},this.parentNode.appendChild(this.iframe),this._attached=!0),this.iframe.classList.add("visible")},e.prototype.hideLoadingUI=function(){this.iframe.classList.remove("visible")},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this.iframe.classList.contains("visible")},set:function(e){e?this.displayLoadingUI():this.hideLoadingUI()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){if(this._message=e,this._contentDocument){for(var n=this._contentDocument.getElementsByClassName("runtime-loading-message"),t=0;t<n.length;t++)n.item(t).innerHTML=e;this.postMessage({type:"message",value:e})}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(e){if(this._progress=e,this._contentDocument){for(var n=this._contentDocument.getElementsByClassName("runtime-loading-progress"),t=0;t<n.length;t++)n.item(t).innerHTML=e.toString()+"%";this.postMessage({type:"progress",value:e})}},enumerable:!0,configurable:!0}),e.prototype.postMessage=function(n){var t=this;setTimeout(function(){var e=JSON.stringify(n);t.iframe.contentWindow.postMessage(e.toString(),location.origin)},100)},e}(),loadingScreen=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.iframe=function(e,n){return this.activate(new iFrameLoadingScreen(e,n)),global.engine.loadingScreen=this._instance,this._instance},e.activate=function(e){this._instance=e},Object.defineProperty(e,"isVisible",{get:function(){if(this._instance)return this._instance.isVisible;var e=document.getElementById("babylonjsLoadingDiv");return!!e&&"1"===e.style.opacity},set:function(e){if(this._instance)this._instance.isVisible=e;else if(e){var n=document.getElementById("babylonjsLoadingDiv");n&&"0"===n.style.opacity&&(n.style.opacity="1"),global.engine.displayLoadingUI()}else global.engine.hideLoadingUI()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"message",{get:function(){return this._instance?this._instance.message:global.engine.loadingScreen.loadingUIText},set:function(e){this._instance?this.instance.message=e:global.engine.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"progress",{get:function(){if(this._instance)return this.instance.progress;console.error("TODO _r.loadingScreen")},set:function(e){this._instance?this.instance.progress=e:this.message+=" "+e+"%"},enumerable:!0,configurable:!0}),e.postMessage=function(e,n){this._instance.postMessage?this._instance.postMessage(e,n):console.error("loadingScreen is not an iframe")},e}(),isReady=!1,callbacks=[],options={container:null,canvas:null,assets:null,scene:null,activeCamera:null,patch:null,ktx:!1,enableOfflineSupport:!1,progress:null,loadingScreen:null,load:null,babylon:null};function launch(e){return isReady=!1,options=extend(options,e),new Promise(function(e,n){_setup().then(function(){_createScene().then(function(){_load().then(function(){_patch().then(function(){_checkActiveCamera(),_beforeFirstRender(),window.addEventListener("resize",function(){global.engine.resize()}),global.engine.resize(),start(),isReady=!0,loadingScreen.isVisible=!1,callbacks.forEach(function(e){try{e.call(global.scene)}catch(e){console.error(e)}}),callbacks.length=0,e(global.scene)})})},function(e){n(e)})})})}function _setup(){return _babylon().then(function(){if(options.canvas)if(is.String(options.canvas)){var e=document.getElementById(options.canvas);is.DOM.canvas(e)?global.canvas=e:console.error("_r.launch - "+options.canvas+"is not a valid HTMLCanvasElement")}else is.DOM.canvas(options.canvas)?global.canvas=options.canvas:console.error("_r.launch - canvas parameter should be a string or a HTMLCanvasElement");options.container?is.String(options.container)?document.getElementById(options.container).appendChild(global.canvas):options.container.appendChild(global.canvas):document.body.appendChild(global.canvas);options.ktx&&(is.Array(options.ktx)?global.engine.setTextureFormatToUse(options.ktx):!0===options.ktx&&global.engine.setTextureFormatToUse(["-astc.ktx","-dxt.ktx","-pvrtc.ktx","-etc2.ktx"])),options.enableOfflineSupport?global.engine.enableOfflineSupport=options.enableOfflineSupport:global.engine.enableOfflineSupport=!1,options.loadingScreen&&(global.engine.loadingScreen=options.loadingScreen),loadingScreen.isVisible=!0})}function _babylon(){if(!options.babylon)return new Promise(function(e,n){e()});switch(options.babylon){case"preview":return load("https://preview.babylonjs.com/babylon.js");case"stable":return load("https://cdn.babylonjs.com/babylon.js");default:return load(options.babylon)}}function _createScene(){if(options.scene)return is.String(options.scene)?options.assets?load.assets(options.assets+options.scene,null,function(e){options.progress&&options.progress(e)}).then(function(e){e.addAllToScene()}):load.assets(options.scene,null,function(e){options.progress&&options.progress(e)}).then(function(e){e.addAllToScene()}):new Promise(function(resolve,reject){if(is.Function(options.scene))try{var result=eval("var canvas=_r.canvas; var engine = _r.engine; var scene=_r.scene; var createScene="+options.scene+";createScene()");2==BABYLON.Engine.LastCreatedEngine.scenes.length&&BABYLON.Engine.LastCreatedEngine.scenes[0].dispose(),is.Scene(result)&&(global.scene=result),resolve()}catch(e){throw reject(e),e}else{if(!is.Scene(options.scene))throw reject("invalid scene parameter in _r.launch"),new Error("invalid scene parameter in _r.launch");global.scene=options.scene,resolve()}})}function _patch(){return options.patch?patch(options.patch):new Promise(function(e){e()})}function _load(){return options.load?load(options.load):new Promise(function(e){e()})}function _beforeFirstRender(){options.beforeFirstRender&&is.Function(options.beforeFirstRender)&&options.beforeFirstRender()}function _checkActiveCamera(){if(is.String(options.activeCamera))activateCamera(options.activeCamera);else if(is.Function(options.activeCamera))try{activateCamera(options.activeCamera.call(global.scene).name)}catch(e){console.error("_r.launch() error on activeCamera",e)}else is.Camera(options.activeCamera)&&activateCamera(options.activeCamera.name);!global.scene.activeCamera&&0<global.scene.cameras.length&&activateCamera(global.scene.cameras[0].name),global.scene.activeCamera&&global.scene.activeCamera.inputs&&!global.scene.activeCamera.inputs.attachedElement&&global.scene.activeCamera.attachControl(global.canvas)}function loop(){global.scene.render()}function start(){global.engine.runRenderLoop(loop)}function ready(e){isReady?e.call(global.scene):callbacks.push(e)}function loop$1(){global.scene.render()}function start$1(){global.engine.runRenderLoop(loop$1)}function pause(){global.engine.stopRenderLoop(loop$1)}function downloadScene(r){var o,i;return r.assets?(o=r.assets,i=r.scene):(i=r.scene.split("/").pop(),o=r.scene.replace(i,"")),new Promise(function(n,t){BABYLON.SceneLoader.LoadAssetContainerAsync(o,i,global.scene,function(e){r.progress&&r.progress(e)}).then(function(e){if(createLibrary(o+i,e),r.patch)try{select(e).globalPatch(r.patch).then(function(){!1!==r.addAllToScene&&e.addAllToScene(),r.ready&&r.ready(e),n(e)})}catch(e){t(e)}else!1!==r.addAllToScene&&e.addAllToScene(),r.ready&&r.ready(e),n(e)},function(e){r.error&&(r.error(e),t(e))})})}function downloadTexture(o){return new Promise(function(n,t){var e=new BABYLON.AssetsManager(global.scene),r=e.addTextureTask(o.name,o.url,o.noMipmap,o.invertY,o.samplingMode);r.onSuccess=function(e){n(e.texture),o.ready&&o.ready(e.texture)},r.onError=function(e){t(e),o.error&&o.error(e)},e.load()})}function downloadCubeTexture(o){return new Promise(function(n,t){var e=new BABYLON.AssetsManager(global.scene),r=e.addCubeTextureTask(o.name,o.url,o.extensions,o.noMipmap,o.files);r.onSuccess=function(e){n(e.texture),o.ready&&o.ready(e.texture)},r.onError=function(e){t(e),o.error&&o.error(e)},e.load()})}var keys=["OnKeyDownTrigger","OnKeyUpTrigger"];function onKeyEvent(n,e,t){void 0===t&&(t=!0),global.scene.actionManager||(global.scene.actionManager=new BABYLON.ActionManager(global.scene));var r=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[n],function(e){trigger(global.scene,n,e)});global.scene.actionManager.registerAction(r);var o=data(global.scene,"_r.e");o||(data(global.scene,"_r.e",[]),o=data(global.scene,"_r.e")),o[n]||(o[n]=[]),o[n].push({handler:e,repeat:t,action:r})}function oneKeyEvent(e,n){onKeyEvent(e,n,!1)}function offKeyEvent(e,t){var n=data(global.scene,"_r.e");n[e]&&(n[e]=t?n[e].filter(function(e){if(e.handler.toString()==t.toString()){if(e.action){var n=global.scene.actionManager.actions.indexOf(e.action);global.scene.actionManager.actions.splice(n,1)}e.listener&&global.scene.removeEventListener(e,e.listener)}return e.handler.toString()!==t.toString()}):[])}var meshes=["OnDoublePickTrigger","OnPickTrigger","OnLeftPickTrigger","OnRightPickTrigger","OnCenterPickTrigger","OnPickDownTrigger","OnPickUpTrigger","OnPickOutTrigger","OnLongPressTrigger","OnPointerOverTrigger","OnPointerOutTrigger"];function onMesh(n,t,e,r){void 0===r&&(r=!0),n.actionManager||(n.actionManager=new BABYLON.ActionManager(global.scene));var o=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[t],function(e){trigger(n,t,e)});n.actionManager.hasSpecificTrigger(BABYLON.ActionManager[t])||n.actionManager.registerAction(o);var i=data(n,"_r.e");i||(data(n,"_r.e",[]),i=data(n,"_r.e")),i[t]||(i[t]=[]),i[t].push({handler:e,repeat:r,action:o})}function oneMesh(e,n,t){onMesh(e,n,t,!1)}function offMesh(t,e,r){var n=data(t,"_r.e");n&&n[e]&&(n[e]=r?n[e].filter(function(e){if(e.handler.toString()==r.toString()&&e.action){var n=t.actionManager.actions.indexOf(e.action);t.actionManager.actions.splice(n,1)}return e.handler.toString()!==r.toString()}):[])}function on$1(e,n,t){void 0===t&&(t=!0),-1!=keys.indexOf(e)?onKeyEvent(e,n,t):on(this,e,n,t)}function off$1(e,n){-1!=keys.indexOf(e)?offKeyEvent(e,n):off(this,e,n)}function one$1(e,n){-1!=keys.indexOf(e)?oneKeyEvent(e,n):one(this,e,n)}function trigger$1(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];trigger.apply(e,[this,n].concat(t))}function color(e){if(e instanceof BABYLON.Color3||e instanceof BABYLON.Color4)return e;if(is.HexColor(e))return BABYLON.Color3.FromHexString(e);if(is.PlainObject(e)){if(e.hasOwnProperty("r")||e.hasOwnProperty("g")||e.hasOwnProperty("b")||e.hasOwnProperty("a")){var n=e.r||0,t=e.g||0,r=e.b||0;return e.a?new BABYLON.Color4(n,t,r,e.a):new BABYLON.Color3(n,t,r)}return console.error("_r.to.Color - invalid color : ",e),new BABYLON.Color3(0,0,0)}if(is.Array(e))return 3==e.length?BABYLON.Color3.FromArray(e):4==e.length?BABYLON.Color4.FromArray(e):(console.error("_r.to.Color - invalid color : ",e),new BABYLON.Color3(0,0,0));if(is.String(e)){if(0==(e=e.trim().toLocaleLowerCase()).indexOf("rgb(")){var o=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/);n=parseFloat(o[0]),t=parseFloat(o[1]),r=parseFloat(o[2]);return new BABYLON.Color3(isNaN(n)?0:n/255,isNaN(t)?0:t/255,isNaN(r)?0:r/255)}if(0==e.indexOf("rgba(")){var i=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),a=(n=parseFloat(i[0]),t=parseFloat(i[1]),r=parseFloat(i[2]),parseFloat(i[3]));return new BABYLON.Color4(isNaN(n)?0:n/255,isNaN(t)?0:t/255,isNaN(r)?0:r/255,isNaN(a)?0:a/255)}switch(e){case"red":return BABYLON.Color3.Red();case"green":return BABYLON.Color3.Green();case"blue":return BABYLON.Color3.Blue();case"black":return BABYLON.Color3.Black();case"white":return BABYLON.Color3.White();case"purple":return BABYLON.Color3.Purple();case"magenta":case"pink":return BABYLON.Color3.Magenta();case"yellow":return BABYLON.Color3.Yellow();case"teal":case"cyan":return BABYLON.Color3.Teal();case"gray":case"grey":return BABYLON.Color3.Gray();case"random":return BABYLON.Color3.Random();default:return console.error("_r.to.Color - invalid color : ",e),new BABYLON.Color3(0,0,0)}}}function color4(e){var n=color(e);return new BABYLON.Color4(n.r,n.g,n.b,1)}function getEasingFunction(e){var n,t,r;if(-1!=e.indexOf("easeInOut"))n=BABYLON.EasingFunction.EASINGMODE_EASEINOUT,t=e.replace("easeInOut","");else if(-1!=e.indexOf("easeIn"))n=BABYLON.EasingFunction.EASINGMODE_EASEIN,t=e.replace("easeIn","");else{if(-1==e.indexOf("easeOut"))return console.info("_r::unrecognized easing function "+e),null;n=BABYLON.EasingFunction.EASINGMODE_EASEOUT,t=e.replace("easeOut","")}switch(t){case"Sine":return(r=new BABYLON.SineEase).setEasingMode(n),r;case"Quad":return(r=new BABYLON.QuadraticEase).setEasingMode(n),r;case"Cubic":return(r=new BABYLON.CubicEase).setEasingMode(n),r;case"Quart":return(r=new BABYLON.QuarticEase).setEasingMode(n),r;case"Quint":return(r=new BABYLON.QuinticEase).setEasingMode(n),r;case"Expo":return(r=new BABYLON.ExponentialEase).setEasingMode(n),r;case"Circ":return(r=new BABYLON.CircleEase).setEasingMode(n),r;case"Back":return(r=new BABYLON.BackEase).setEasingMode(n),r;case"Elastic":return(r=new BABYLON.ElasticEase).setEasingMode(n),r;case"Bounce":return(r=new BABYLON.BounceEase).setEasingMode(n),r;default:return console.warn("_r::unrecognized easing function "+e),null}}function getLoopMode(e){if(is.Boolean(e.loop)&&e.loop)return BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;if(is.String(e.loop)){if("cycle"==e.loop.toLowerCase())return BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE;if("relative"==e.loop.toLocaleLowerCase()||"pingpong"==this.loop.toLocaleLowerCase())return BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE}else if(is.Number(e.loop))return e.loop;return BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT}function getAnimationType(e,n){return is.Vector2(e[n])?BABYLON.Animation.ANIMATIONTYPE_VECTOR2:is.Vector3(e[n])?BABYLON.Animation.ANIMATIONTYPE_VECTOR3:is.Number(e[n])?BABYLON.Animation.ANIMATIONTYPE_FLOAT:is.Color(e[n])?BABYLON.Animation.ANIMATIONTYPE_COLOR3:is.Quaternion(e[n])?BABYLON.Animation.ANIMATIONTYPE_QUATERNION:is.Matrix(e[n])?BABYLON.Animation.ANIMATIONTYPE_MATRIX:is.Size(e[n])?BABYLON.Animation.ANIMATIONTYPE_SIZE:null}function isAnimatable(e,n){return null!==getAnimationType(e,n)}function getKeys(e,n,t,r){if(r.keys)return r.keys;var o,i=e[n];switch(getAnimationType(e,n)){case BABYLON.Animation.ANIMATIONTYPE_COLOR3:select(o=i.clone()).patch(color(t));break;case BABYLON.Animation.ANIMATIONTYPE_FLOAT:o=t;break;case BABYLON.Animation.ANIMATIONTYPE_MATRIX:select(o=i.clone()).patch(t);break;default:o=i.clone(),Object.getOwnPropertyNames(t).forEach(function(e){o[e]=t[e]})}return[{frame:0,value:i},{frame:r.fps*r.duration,value:o}]}function getAnimationsForElement(r,o,i){var a=[],e=Object.getOwnPropertyNames(o);return r.animations||(r.animations=[]),e.forEach(function(e){if(isAnimatable(r,e)){var n=new BABYLON.Animation("_r.animation"+r.animations.length,e,i.fps,getAnimationType(r,e),getLoopMode(i)),t=getKeys(r,e,o[e],i);n.setKeys(t),i.easing&&n.setEasingFunction(getEasingFunction(i.easing)),a.push(n)}else console.error(e+" is not animatable")}),a}function findSomethingToAnimate(t,r){var e=Object.getOwnPropertyNames(r),o=[];return e.forEach(function(e){if(isAnimatable(t,e))o.push({element:t,property:e,patch:r[e]});else{if(is.Primitive(r[e]))return[];var n=findSomethingToAnimate(t[e],r[e]);o=o.concat(n)}}),o}global.fn.on=function(n,t){this.each(function(e){is.Mesh(e)&&-1!==meshes.indexOf(n)?onMesh(e,n,t):on(e,n,t)})},global.fn.one=function(n,t){this.each(function(e){is.Mesh(e)&&-1!==meshes.indexOf(n)?oneMesh(e,n,t):one(e,n,t)})},global.fn.off=function(n,t){this.each(function(e){is.Mesh(e)&&-1!==meshes.indexOf(n)?offMesh(e,n,t):off(e,n,t)})},global.fn.trigger=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.each(function(n){trigger.apply(e,[n,t].concat(r))})},registerPlugin({test:function(e,n,t){return!is.Function(n[t])&&e[t]instanceof BABYLON.Color3||e[t]instanceof BABYLON.Color4},resolve:function(e,n,t){return e[t]=color(n[t]),e[t]}}),registerPlugin({test:function(e,n,t){return"*"===t.trim()},resolve:function(e,n,t){return is.MultiMaterial(e)?patchElements(e.subMaterials,n[t],e):is.Array(e)?patchElements(e,n[t]):patchElement(e,n[t])}}),registerPlugin({test:function(e,n,t){return-1!==["diffuseFresnelParameters","opacityFresnelParameters","emissiveFresnelParameters","refractionFresnelParameters","reflectionFresnelParameters"].indexOf(t)&&!e.target[t]},resolve:function(e,n,t){return new BABYLON.FresnelParameters}}),registerPlugin({test:function(e,n,t){return"execute"===t||"exec"===t},resolve:function(e,n,t,r){try{var o=n[t];return e?o.apply(e,r):o.apply(global.scene,r)}catch(e){console.error(e)}}}),registerPlugin({test:function(e,n,t){return"scene"===t},resolve:function(e,n,t){if(!is.Function(n[t]))return globalPatch(n[t],e);try{global.scene=n[t]()}catch(e){console.error(e)}}}),registerPlugin({test:function(e,n,t){return"data"===t},resolve:function(t,e,n,r){var o=e[n],i=Object.getOwnPropertyNames(o),a={};i.forEach(function(e){var n=o[e];is.Function(n)?(console.log(t,r),a[e]=function(){return n.apply(t,r)},select(t).data(e,a[e])):(a[e]=n,select(t).data(e,n))})}}),registerPlugin({test:function(e,n,t){return-1!=["on","off","trigger","one"].indexOf(t)},resolve:function(t,r,o,e){switch(o){case"on":Object.getOwnPropertyNames(r[o]).forEach(function(e){var n=r[o][e];if(is.Function(n))return select(t).on(e,n);select(t).on(e,function(){return select(t).patch(r[o][e])})});break;case"off":if(is.String(r[o]))return select(t).off(r[o]);Object.getOwnPropertyNames(r[o]).forEach(function(e){select(t).off(e,r[o][e])});break;case"trigger":if(is.String(r[o]))return select(t).trigger(r[o]);Object.getOwnPropertyNames(r[o]).forEach(function(e){return select(t).trigger(e,r[o][e])});break;case"one":Object.getOwnPropertyNames(r[o]).forEach(function(e){var n=r[o][e];if(is.Function(n))return select(t).one(e,n);select(t).one(e,function(){return select(t).patch(r[o][e])})})}}}),registerPlugin({test:function(e,n,t){return!1},resolve:function(e,n,t,r){}}),registerPlugin({test:function(e,n,t){return"patchParallel"===t},resolve:function(n,e,t,r){var o=[];return n?e[t].forEach(function(e){console.log("push",e),o.push(select(n).patch(e))}):e[t].forEach(function(e){o.push(patch(e))}),console.log("call to patchParallel",o),Promise.all(o)}});var defaultOptions={fps:30,duration:.4,speedRatio:1,loopMode:!1};function getOptions(e){var n={};return e||(e=.4),is.Number(e)?(n.duration=e,n.loop=!1):(n=e).loop?is.Boolean(n.loop)&&n.loop&&(n.loop="cycle"):n.loop=!1,n=extend({},defaultOptions,n)}var count=0,utilLayer,jm,km;function animate(e,n,t){var r=select(e),o=getOptions(t),i=new BABYLON.AnimationGroup("_r.animate.AnimationsGroup"+count++);return r.each(function(e){findSomethingToAnimate(e,n).forEach(function(e){var n=e.element,t={};t[e.property]=e.patch,getAnimationsForElement(n,t,o).forEach(function(e){i.addTargetedAnimation(e,n)})})}),i.speedRatio=o.speedRatio,o.complete&&i.onAnimationGroupEndObservable.add(o.complete),i.onAnimationEndObservable.add(function(e){var n=e.target.animations.indexOf(e.animation);e.target.animations=e.target.animations.splice(n,1)}),0!=o.loop?i.play(!0):i.play(),i}function showMeshNormals(e,n,t){hideMeshNormals(e);var r=e.getVerticesData(BABYLON.VertexBuffer.NormalKind),o=e.getVerticesData(BABYLON.VertexBuffer.PositionKind);t=color(t),n=n||1;for(var i=[],a=0;a<r.length;a+=3){var s=BABYLON.Vector3.FromArray(o,a),c=s.add(BABYLON.Vector3.FromArray(r,a).scaleInPlace(n));i.push([s.add(e.position),c.add(e.position)])}var l=BABYLON.MeshBuilder.CreateLineSystem("_r.normals."+e.uniqueId,{lines:i},global.scene);return l.color=t,data(e,"_r.normals",l),l}function hideMeshNormals(e){var n=data(e,"_r.normals");n&&n.dispose()}function showNormals(e,n,t){void 0===n&&(n=1),void 0===t&&(t="red"),e?select(e).each(function(e){is.Mesh(e)&&showMeshNormals(e,n,t)}):global.scene.meshes.forEach(function(e){showMeshNormals(e,n,t)})}function hideNormals(e){e?select(e).each(function(e){is.Mesh(e)&&hideMeshNormals(e)}):global.scene.meshes.forEach(function(e){hideMeshNormals(e)})}function showMeshWireframe(e,n,t,r){null==e.edgesRenderer?(e.enableEdgesRendering(n),e.edgesColor=r,e.edgesWidth=t):(e.enableEdgesRendering(n),e.edgesColor=r,e.edgesWidth=t,e.edgesRenderer.isEnabled=!0)}function hideMeshWireframe(e){e.edgesRenderer&&(e.edgesRenderer.isEnabled=!1)}function showWireframe(e,n,t,r){void 0===n&&(n=1),void 0===t&&(t=1),void 0===r&&(r=new BABYLON.Color4(130/255,230/255,1,.85)),e?select(e).each(function(e){is.Mesh(e)&&showMeshWireframe(e,n,t,color(r))}):global.scene.meshes.forEach(function(e){showMeshWireframe(e,n,t,color(r))})}function hideWireframe(e){e?select(e).each(function(e){is.Mesh(e)&&hideMeshWireframe(e)}):global.scene.meshes.forEach(function(e){hideMeshWireframe(e)})}function initUtilLayer(){utilLayer||(utilLayer=new BABYLON.UtilityLayerRenderer(global.scene))}function showMeshGizmo(e,n,t,r){var o;switch(n="string"==typeof n?n.toLowerCase():n,t="string"==typeof t?t.toLowerCase():t,hideMeshGizmo(e),n){case"position":o=new BABYLON.PositionGizmo(utilLayer);break;case"rotation":o=new BABYLON.RotationGizmo(utilLayer);break;case"scale":o=new BABYLON.ScaleGizmo(utilLayer);break;case"boundingbox":default:o=new BABYLON.BoundingBoxGizmo(r,utilLayer)}return o.attachedMesh=e,t&&o.xGizmo&&(console.info("_r : gizmo axis works only with BABYLON > 4.0.3, actual is: "+BABYLON.Engine.Version),o.xGizmo.isEnabled=-1!==t.indexOf("x"),o.yGizmo.isEnabled=-1!==t.indexOf("y"),o.zGizmo.isEnabled=-1!==t.indexOf("z"),o.updateGizmoRotationToMatchAttachedMesh=!1,o.updateGizmoPositionToMatchAttachedMesh=!0),select(e).data("runtime-gizmo",o),o}function hideMeshGizmo(e){var n=select(e).data("runtime-gizmo");n&&(n.dispose(),select(e).data("runtime-gizmo",null))}function showGizmo(e,n,t,r){void 0===r&&(r=new BABYLON.Color3(130/255,230/255,1));var o=[];return initUtilLayer(),e?select(e).each(function(e){is.Mesh(e)&&o.push(showMeshGizmo(e,n,t,r))}):global.scene.meshes.forEach(function(e){o.push(showMeshGizmo(e,n,t,r))}),o}function hideGizmo(e){e?select(e).each(function(e){is.Mesh(e)&&hideMeshGizmo(e)}):global.scene.meshes.forEach(function(e){hideMeshGizmo(e)})}function show(e,n){e.split(",").forEach(function(e){switch(e.trim()){case"normals":showNormals(n);break;case"wireframe":showWireframe(n);break;case"gizmo":showGizmo(n);break;default:console.error(e+" is not supported by _r.show")}})}function hide(e,n){e.split(",").forEach(function(e){switch(e.trim()){case"normals":hideNormals(n);break;case"wireframe":hideWireframe(n);break;case"gizmo":hideGizmo(n);break;default:console.error(e+" is not supported by _r.hide")}})}global.fn.animate=function(e,n){return animate(this.toArray(),e,n)},global.fn.fadeOut=function(e){var t=getOptions(e),r=new BABYLON.AnimationGroup("_r.animate.AnimationsGroup"+count++);return this.each(function(n){var e=[];is.Mesh(n)&&(e=getAnimationsForElement(n,{visibility:0},t)),is.Material(n)&&(e=getAnimationsForElement(n,{alpha:0},t)),is.Texture(n)&&(e=getAnimationsForElement(n,{level:0},t)),is.Light(n)&&(e=getAnimationsForElement(n,{intensity:0},t)),e.forEach(function(e){r.addTargetedAnimation(e,n)})}),r.speedRatio=t.speedRatio,t.complete&&r.onAnimationGroupEndObservable.add(t.complete),r.play(),r},global.fn.fadeIn=function(e){var t=getOptions(e),r=new BABYLON.AnimationGroup("_r.animate.AnimationsGroup"+count++);return this.each(function(n){var e=[];is.Mesh(n)&&(e=getAnimationsForElement(n,{visibility:1},t)),is.Material(n)&&(e=getAnimationsForElement(n,{alpha:1},t)),is.Texture(n)&&(e=getAnimationsForElement(n,{level:1},t)),is.Light(n)&&(e=getAnimationsForElement(n,{intensity:1},t)),e.forEach(function(e){r.addTargetedAnimation(e,n)})}),r.speedRatio=t.speedRatio,t.complete&&r.onAnimationGroupEndObservable.add(t.complete),r.play(),r},global.fn.finish=function(){this.each(function(e){global.scene.getAllAnimatablesByTarget(e).forEach(function(e){e.stop()}),e.animations=[]})},jm=show||(show={}),jm.normals=showNormals,jm.wireframe=showWireframe,jm.gizmo=showGizmo,km=hide||(hide={}),km.normals=hideNormals,km.wireframe=hideWireframe,km.gizmo=hideGizmo;var router={hashChangedListener:[],set:function(e){window.removeEventListener("hashchange",hashChangeListener),window.location.hash=e,this.trigger(e),window.addEventListener("hashchange",hashChangeListener)},get:function(){if(1<window.location.hash.length)return window.location.hash.substr(1)},on:function(e,n,t){void 0===t&&(t=!0),is.Function(e)?this.hashChangedListener.push(e):on(this,e,n,t)},off:function(e,n){off(this,e,n)},one:function(e,n){one(this,e,n)},trigger:function(n,e){this.pause||(this.hashChangedListener.forEach(function(e){e(n)}),trigger(this,n,e))},pause:!1};function hashChangeListener(e){router.trigger(router.get())}function merge(e,n,t){var r={};return Object.getOwnPropertyNames(n).forEach(function(e){t&&-1!=t.indexOf(e)||(r[e]=n[e])}),e=extend(e,r)}window.addEventListener("hashchange",hashChangeListener),global.fn.freeze=function(){this.forEach(function(e){is.Mesh(e)&&e.freezeWorldMatrix(),is.Material(e)&&e.freeze()})},global.fn.unfreeze=function(){this.forEach(function(e){is.Mesh(e)&&e.unfreezeWorldMatrix(),is.Material(e)&&e.unfreeze()})};var index={get canvas(){return global.canvas},set canvas(e){global.canvas=e},get scene(){return global.scene},set scene(e){global.scene=e},get engine(){return global.engine},set engine(e){global.engine=e},get TRACE(){return global.TRACE},set TRACE(e){global.TRACE=e},activateCamera:activateCamera,launch:launch,ready:ready,start:start$1,pause:pause,downloadScene:downloadScene,downloadTexture:downloadTexture,downloadCubeTexture:downloadCubeTexture,createLibrary:createLibrary,library:library,data:data,on:on$1,off:off$1,one:one$1,trigger:trigger$1,select:select,patch:patch,match:match,is:is,color:color,color4:color4,animate:animate,activeCamera:activateCamera,fn:global.fn,queryString:queryString,router:router,show:show,hide:hide,loadingScreen:loadingScreen,extend:extend,merge:merge,load:load};return index});
//# sourceMappingURL=_r.min.js.map
